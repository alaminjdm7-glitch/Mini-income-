<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick Earn</title>

<!-- Telegram WebApp -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Ad Network -->
<script src="//libtl.com/sdk.js" data-zone="10314131" data-sdk="show_10314131"></script>

<style>
body{
    background:#f2f2f7;
    margin:0;
    font-family:Arial,sans-serif;
    padding-bottom:70px;
}
.container{
    max-width:420px;
    margin:auto;
    padding:15px;
}
.card{
    background:#fff;
    padding:20px;
    border-radius:12px;
    box-shadow:0 2px 5px rgba(0,0,0,.1);
    margin-bottom:15px;
    text-align:center;
}
.page{display:none;}
.page.active{display:block;}
button{
    width:100%;
    padding:12px;
    font-size:16px;
    font-weight:bold;
    border:none;
    border-radius:8px;
    background:#4E73DF;
    color:#fff;
    margin-top:10px;
}
.btn-green{background:#28a745;}
input,select{
    width:100%;
    padding:12px;
    margin-top:10px;
    font-size:16px;
    border-radius:8px;
    border:1px solid #ccc;
}
.nav{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    background:#fff;
    display:flex;
    justify-content:space-around;
    padding:12px 0;
    border-top:1px solid #ddd;
}
.nav-item{
    color:#999;
    font-weight:bold;
    cursor:pointer;
}
.nav-item.active{color:#4E73DF;}
.history-item{
    background:#f8f9fa;
    padding:10px;
    border-radius:6px;
    margin-bottom:5px;
    font-size:13px;
    text-align:left;
}
</style>
</head>

<body>

<div class="container">

<!-- HOME -->
<div class="page active" id="home-page">
    <div class="card">
        <h2>Welcome <span id="user-name">User</span></h2>
        <p>User ID: <b id="user-id"></b></p>
        <h1>৳<span id="balance">0.00</span></h1>
        <p>Ads Watched: <b id="today-ads">0</b></p>
        <button onclick="watchAd()">Watch Ad & Earn</button>
    </div>
</div>

<!-- WITHDRAW -->
<div class="page" id="withdraw-page">
    <div class="card">
        <form onsubmit="event.preventDefault(); sendWithdraw();">
            <input id="withdraw-amount" type="number" placeholder="Amount (Min 120)">
            <input id="account-number" placeholder="Bkash / Nagad Number">
            <select id="withdraw-method">
                <option>Bkash</option>
                <option>Nagad</option>
                <option>Rocket</option>
            </select>
            <button class="btn-green" type="submit">Withdraw</button>
        </form>
    </div>

    <div class="card">
        <h3>Withdraw History</h3>
        <div id="history-list"></div>
    </div>
</div>

<!-- PROFILE -->
<div class="page" id="profile-page">
    <div class="card">
        <p>Name: <b id="profile-name"></b></p>
        <p>User ID: <b id="profile-id"></b></p>
        <p>Balance: ৳<b id="profile-balance"></b></p>
        <p>Ads Watched: <b id="profile-ads"></b></p>
    </div>
</div>

</div>

<!-- NAV -->
<div class="nav">
    <div class="nav-item active" onclick="navTo('home-page',this)">Home</div>
    <div class="nav-item" onclick="navTo('withdraw-page',this)">Withdraw</div>
    <div class="nav-item" onclick="navTo('profile-page',this)">Profile</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

/* ====== BOT CONFIG (FROM YOUR CODE) ====== */
const BOT_TOKEN = "8547106742:AAGzYH6K6dDFR3lB4RdDcCRpZ_VBmlPCkuw";
const ADMIN_ID = "8188773875";

/* ====== SETTINGS ====== */
const AD_REWARD = 10;
const DAILY_AD_LIMIT = 50;
const MIN_WITHDRAW = 120;

/* ====== USER ====== */
let user = tg.initDataUnsafe?.user || {};
let USER_ID = user.id || Date.now();
let USER_NAME = user.first_name || "Guest";
let USER_USERNAME = user.username || "NoUsername";

/* ====== STORAGE ====== */
function load(k,d){return JSON.parse(localStorage.getItem(k+"_"+USER_ID))||d;}
function save(k,v){localStorage.setItem(k+"_"+USER_ID,JSON.stringify(v));}

let balance = load("balance",0);
let adsWatched = load("ads",0);
let history = load("history",[]);

/* ====== UI ====== */
function updateUI(){
    document.getElementById("user-name").innerText = USER_NAME;
    document.getElementById("user-id").innerText = USER_ID;
    document.getElementById("balance").innerText = balance.toFixed(2);
    document.getElementById("today-ads").innerText = adsWatched;

    document.getElementById("profile-name").innerText = USER_NAME;
    document.getElementById("profile-id").innerText = USER_ID;
    document.getElementById("profile-balance").innerText = balance.toFixed(2);
    document.getElementById("profile-ads").innerText = adsWatched;

    renderHistory();
}

function renderHistory(){
    let box = document.getElementById("history-list");
    box.innerHTML = history.length ? "" : "<p>No history</p>";
    history.slice().reverse().forEach(h=>{
        box.innerHTML += `
        <div class="history-item">
            Amount: ৳${h.amount}<br>
            Method: ${h.method}<br>
            Number: ${h.number}
        </div>`;
    });
}

/* ====== NAV ====== */
function navTo(id,el){
    document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    if(el){
        document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
        el.classList.add("active");
    }
}

/* ====== AD ====== */
function watchAd(){
    if(adsWatched>=DAILY_AD_LIMIT){alert("Daily limit reached");return;}
    show_10314131('pop').then(()=>{
        adsWatched++;
        balance+=AD_REWARD;
        save("ads",adsWatched);
        save("balance",balance);
        updateUI();
    });
}

/* ====== WITHDRAW ====== */
async function sendWithdraw(){
    let amount = Number(document.getElementById("withdraw-amount").value);
    let number = document.getElementById("account-number").value;
    let method = document.getElementById("withdraw-method").value;

    if(amount<MIN_WITHDRAW || amount>balance){alert("Invalid amount");return;}

    balance -= amount;
    save("balance",balance);

    history.push({amount,number,method});
    save("history",history);
    updateUI();

    let msg = `New Withdraw Request
Name: ${USER_NAME}
Username: @${USER_USERNAME}
User ID: ${USER_ID}

Amount: ${amount}
Method: ${method}
Number: ${number}`;

    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({chat_id:ADMIN_ID,text:msg})
    });
}

updateUI();
</script>

</body>
</html>
