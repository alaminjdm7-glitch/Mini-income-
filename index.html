<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Earning App – Complete</title>

    <!-- YOUR AD NETWORK SCRIPT -->
    <script src='//libtl.com/sdk.js' data-zone='10314131' data-sdk='show_10314131'></script>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #0f0f0f;
            color: white;
        }

        .page {
            display: none;
            padding: 20px;
        }
        .page.active {
            display: block;
        }

        .nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #111;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #333;
        }

        .nav-item {
            color: #aaa;
            font-size: 15px;
            text-align: center;
            cursor: pointer;
        }

        .nav-item.active {
            color: #00ff99;
        }

        button {
            width: 100%;
            padding: 12px;
            font-size: 17px;
            border: none;
            border-radius: 8px;
            background: #ff3c3c;
            color: white;
            margin-top: 18px;
        }

        input, select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            background: #1c1c1c;
            border: 1px solid #333;
            color: white;
            border-radius: 6px;
            margin-top: 12px;
        }
    </style>
</head>

<body>

    <!-- HOME PAGE -->
    <div class="page active" id="home-page">
        <h2>Welcome to Earning App</h2>
        <p>Earn Money by Watching Ads</p>
        <h1>Balance: <span id="balance">0.00</span> BDT</h1>

        <button id="start-earning">Start Earning Now</button>
        <button id="withdraw-btn" style="background:#00cc66;">Withdraw</button>
    </div>

    <!-- EARN PAGE -->
    <div class="page" id="earn-page">
        <h2>Earn by Watching Ads</h2>
        <p>Daily Ad Limit: <span id="daily-limit">20</span></p>
        <p>Today Watched: <span id="today-ads">0</span></p>

        <button id="watch-ad">Watch Ad & Earn</button>
    </div>

    <!-- WITHDRAW PAGE -->
    <div class="page" id="withdraw-page">
        <h2>Withdraw Money</h2>

        <form id="withdraw-form">
            <label>Payment Method</label>
            <select id="withdraw-method">
                <option value="bkash">bKash</option>
                <option value="nagad">Nagad</option>
                <option value="rocket">Rocket</option>
            </select>

            <label>Account Number</label>
            <input id="account-number" type="number" placeholder="Enter Number" />

            <label>Amount</label>
            <input id="withdraw-amount" type="number" placeholder="Minimum 100" />

            <button type="submit" style="background:#00cc66;">Submit Withdraw</button>
        </form>
    </div>

    <!-- PROFILE PAGE -->
    <div class="page" id="profile-page">
        <h2>Profile</h2>
        <p>Name: <span id="profile-name">User</span></p>
        <p>Balance: <span id="profile-balance">0.00</span> BDT</p>
        <p>Ads Watched: <span id="profile-ads-watched">0</span></p>
        <p>Referrals: <span id="profile-referrals">0</span></p>
    </div>

    <!-- Navigation -->
    <div class="nav">
        <div class="nav-item active" data-page="home-page">Home</div>
        <div class="nav-item" data-page="earn-page">Earn</div>
        <div class="nav-item" data-page="withdraw-page">Withdraw</div>
        <div class="nav-item" data-page="profile-page">Profile</div>
    </div>


<script>
    const tg = window.Telegram?.WebApp;

    // Constants
    const AD_REWARD = 0.20;
    const DAILY_AD_LIMIT = 20;
    const MIN_WITHDRAW = 100;

    // Local Storage Loader
    function load(key, defaultValue) {
        return localStorage.getItem(key) ? JSON.parse(localStorage.getItem(key)) : defaultValue;
    }

    function save(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
    }

    let balance = load("balance", 0);
    let adsWatched = load("adsWatched", 0);
    let referrals = load("referrals", 0);

    // UI Update
    function updateUI() {
        document.getElementById("balance").textContent = balance.toFixed(2);
        document.getElementById("today-ads").textContent = adsWatched;
        document.getElementById("daily-limit").textContent = DAILY_AD_LIMIT;
        document.getElementById("profile-name").textContent = tg?.initDataUnsafe?.user?.first_name || "User";
        document.getElementById("profile-balance").textContent = balance.toFixed(2);
        document.getElementById("profile-ads-watched").textContent = adsWatched;
        document.getElementById("profile-referrals").textContent = referrals;
    }

    updateUI();

    // Navigation
    document.querySelectorAll(".nav-item").forEach(btn => {
        btn.addEventListener("click", () => {
            document.querySelectorAll(".nav-item").forEach(n => n.classList.remove("active"));
            btn.classList.add("active");

            let page = btn.getAttribute("data-page");

            document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
            document.getElementById(page).classList.add("active");
        });
    });

    // WATCH AD BUTTON WITH YOUR REWARDED AD
    document.getElementById("watch-ad").addEventListener("click", () => {

        if (adsWatched >= DAILY_AD_LIMIT) {
            tg?.showAlert("আজকের লিমিট পূর্ণ হয়েছে!");
            return;
        }

        // Show Reward Ad
        show_10314131('pop')
            .then(() => {
                // USER WATCHED THE AD SUCCESSFULLY → GIVE REWARD
                adsWatched++;
                balance += AD_REWARD;

                save("adsWatched", adsWatched);
                save("balance", balance);
                updateUI();
            })
            .catch(() => {
                // ERROR PLAYING AD → NO REWARD
                tg?.showAlert("Ad failed to load!");
            });
    });

    // Start Earning → Earn Page
    document.getElementById("start-earning").addEventListener("click", () => {
        document.querySelector('[data-page="earn-page"]').click();
    });

    // Withdraw → Withdraw Page
    document.getElementById("withdraw-btn").addEventListener("click", () => {
        document.querySelector('[data-page="withdraw-page"]').click();
    });

    // Withdraw Form
    document.getElementById("withdraw-form").addEventListener("submit", (e) => {
        e.preventDefault();

        let amount = Number(document.getElementById("withdraw-amount").value);

        if (amount < MIN_WITHDRAW) {
            tg?.showAlert("Minimum withdraw is 100 BDT!");
            return;
        }
        if (amount > balance) {
            tg?.showAlert("Balance is not enough!");
            return;
        }

        balance -= amount;
        save("balance", balance);

        updateUI();

        tg?.showAlert("Withdraw Request Submitted!");
        document.getElementById("withdraw-form").reset();
    });
</script>

</body>
</html>
