<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick Earn</title>

<!-- AD NETWORK -->
<script src="//libtl.com/sdk.js" data-zone="10314131" data-sdk="show_10314131"></script>

<style>
body {
    background: #f2f2f7;
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    scroll-behavior: smooth;
}
.container {
    max-width: 420px;
    margin: auto;
    padding: 20px;
}
.card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 15px;
}
button {
    width: 100%;
    padding: 12px;
    background: #4E73DF;
    border: none;
    color: white;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    margin-top:5px;
}
.nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    display: flex;
    justify-content: space-around;
    padding: 12px 0;
    border-top: 1px solid #ccc;
}
.nav div {
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
}
input, select { width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; border-radius: 6px; border:1px solid #ccc; }
.withdraw-history, .task-history { max-height:200px; overflow-y:auto; margin-top:10px; }
.notice { background:#FFFBCC; padding:10px; border-radius:6px; margin-bottom:10px; }
</style>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
const tg = window.Telegram.WebApp;
tg.expand();

const BOT_TOKEN = "8547106742:AAGzYH6K6dDFR3lB4RdDcCRpZ_VBmlPCkuw";
const ADMIN_ID = "8188773875";

// Telegram user info
let user = tg?.initDataUnsafe?.user || {};
let USER_NAME = user?.first_name || "Guest";
let USER_USERNAME = user?.username || "NoUsername";
let USER_ID = user?.id || Date.now();

// Task & Ad Config
const CHANNEL_JOIN_REWARD = 5;
const CHANNEL_VIEW_REWARD = 1;
const AD_REWARD = 10; // 10 ‡¶ü‡¶æ‡¶ï‡¶æ
const MAX_DAILY_ADS = 30;
const MAX_WITHDRAW = 500; // Withdraw limit
const CHANNEL_JOIN_LINKS = [
  "https://t.me/DevleparX_Namid",
  "https://t.me/GmailMarketingB",
  "https://t.me/BDIncomep"
];
const CHANNEL_VIEW_LINK = "https://t.me/GmailMarketing_99bot";

// User Data
let balance = JSON.parse(localStorage.getItem("balance_" + USER_ID) || "0");
let withdrawHistory = JSON.parse(localStorage.getItem("history_" + USER_ID) || "[]");
let taskHistory = JSON.parse(localStorage.getItem("task_history_" + USER_ID) || "[]");

// UTIL
function todayDate() { let d=new Date(); return d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate(); }
function getData(key, def){ return JSON.parse(localStorage.getItem(key)) ?? def; }
function setData(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

// UI Update
function updateUserUI(){
    document.getElementById("nameBox").innerText = USER_NAME;
    document.getElementById("idBox").innerText = USER_ID;
    document.getElementById("balanceBox").innerText = balance.toFixed(2);
    let adData = getAdInfo();
    document.getElementById("adsWatched").innerText = adData.count + " / " + MAX_DAILY_ADS;
}
updateUserUI();

// AD TASK
function getAdInfo(){
    let data = getData("daily_ads_" + USER_ID, {date:todayDate(), count:0});
    if(data.date !== todayDate()){ data.date = todayDate(); data.count = 0; }
    return data;
}

function watchAd(){
    let adData = getAdInfo();
    if(adData.count >= MAX_DAILY_ADS){
        alert("‚ùå ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§!\n‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ü‡¶ú‡¶ï‡ßá ‡ß©‡ß¶ ‡¶ü‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶´‡ßá‡¶≤‡ßá‡¶õ‡ßá‡¶®‡•§\n‚è∞ ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§");
        return;
    }
    if(typeof show_10314131 !== "function"){ alert("‚ö†Ô∏è Ad ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡¶®‡¶ø, ‡¶™‡¶∞‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®"); return; }

    show_10314131("pop").then(()=>{
        adData.count++;
        balance += AD_REWARD;
        setData("daily_ads_" + USER_ID, adData);
        localStorage.setItem("balance_" + USER_ID, balance);
        updateUserUI();

        taskHistory.push({type:"Ad Watch", reward:AD_REWARD, date:new Date().toLocaleString()});
        localStorage.setItem("task_history_" + USER_ID, JSON.stringify(taskHistory));

        alert("‚úÖ ‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®!\n‡¶Ü‡¶™‡¶®‡¶ø " + AD_REWARD + " ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®");
    });
}

// CHANNEL JOIN TASK (ONE TIME PER CHANNEL)
function joinChannel(index){
    let joinedKey = "joined_channel_" + USER_ID + "_" + index;
    if(getData(joinedKey,false)){
        alert("‚úÖ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶á ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®");
        return;
    }
    window.open(CHANNEL_JOIN_LINKS[index], "_blank");
    setTimeout(()=>{
        setData(joinedKey, true);
        balance += CHANNEL_JOIN_REWARD;
        localStorage.setItem("balance_" + USER_ID, balance);
        updateUserUI();
        taskHistory.push({type:"Channel Join", reward:CHANNEL_JOIN_REWARD, date:new Date().toLocaleString(), channel:CHANNEL_JOIN_LINKS[index]});
        localStorage.setItem("task_history_" + USER_ID, JSON.stringify(taskHistory));
        alert("üéâ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ú‡ßü‡ßá‡¶® ‡¶∏‡¶´‡¶≤!\n‡¶Ü‡¶™‡¶®‡¶ø " + CHANNEL_JOIN_REWARD + " ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®");
    }, 4000);
}

// CHANNEL VIEW TASK (FIRST TIME ONLY)
function viewChannel(){
    let firstViewKey = "first_view_" + USER_ID;
    if(!getData(firstViewKey,false)){
        // First time view
        window.open(CHANNEL_VIEW_LINK, "_blank");
        setData(firstViewKey,true);
        taskHistory.push({type:"Channel View", reward:CHANNEL_VIEW_REWARD, date:new Date().toLocaleString(), first:true});
        localStorage.setItem("task_history_" + USER_ID, JSON.stringify(taskHistory));
        balance += CHANNEL_VIEW_REWARD;
        localStorage.setItem("balance_" + USER_ID, balance);
        updateUserUI();
        alert("üëÄ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡¶¨‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶â ‡¶∏‡¶´‡¶≤!\n‡¶Ü‡¶™‡¶®‡¶ø " + CHANNEL_VIEW_REWARD + " ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®");
    } else {
        // Subsequent clicks only Ad
        watchAd();
    }
}

// WITHDRAW
async function sendWithdraw(){
    let amount = Number(document.getElementById("amount").value);
    let number = document.getElementById("number").value;
    let method = document.getElementById("method").value;

    if(!amount || !number){ alert("‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®"); return; }
    if(amount > balance){ alert("Insufficient balance!"); return; }
    if(amount > MAX_WITHDRAW){ alert("‚ö†Ô∏è Maximum withdraw is " + MAX_WITHDRAW + " BDT"); return; }
    if(amount < 120){ alert("Minimum withdraw 120 BDT!"); return; }

    balance -= amount;
    localStorage.setItem("balance_" + USER_ID, balance);

    let now = new Date();
    withdrawHistory.push({amount, number, method, date: now.toLocaleDateString(), time: now.toLocaleTimeString()});
    localStorage.setItem("history_" + USER_ID, JSON.stringify(withdrawHistory));
    updateUserUI();
    loadHistory();

    let msg = `üì¢ New Withdraw Request
üë§ Name: ${USER_NAME}
üîó Username: @${USER_USERNAME}
üÜî User ID: ${USER_ID}
üíµ Amount: ‡ß≥${amount}
üì± Number: ${number}
üí≥ Method: ${method}`;

    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({chat_id:ADMIN_ID, text:msg, parse_mode:"Markdown"})
    });
    alert("Withdraw Request Sent!");
    document.getElementById("withdrawForm").reset();
}

// LOAD WITHDRAW HISTORY
function loadHistory(){
    const box = document.getElementById("historyList");
    box.innerHTML = "";
    if(withdrawHistory.length===0){ box.innerHTML="<p>No withdraw history yet.</p>"; return; }
    withdrawHistory.slice().reverse().forEach(w=>{
        box.innerHTML += `<div class='card'>
            <b>Amount:</b> ‡ß≥${w.amount}<br>
            <b>Number:</b> ${w.number}<br>
            <b>Method:</b> ${w.method}<br>
            <b>Date:</b> ${w.date} ${w.time}
        </div>`;
    });
}

// LOAD TASK HISTORY
function loadTaskHistory(){
    const box = document.getElementById("taskHistoryList");
    box.innerHTML = "";
    if(taskHistory.length===0){ box.innerHTML="<p>No task history yet.</p>"; return; }
    taskHistory.slice().reverse().forEach(t=>{
        box.innerHTML += `<div class='card'>
            <b>Task:</b> ${t.type}<br>
            <b>Reward:</b> ‡ß≥${t.reward}<br>
            ${t.channel ? "<b>Channel:</b> " + t.channel + "<br>" : ""}
            <b>Date:</b> ${t.date}
        </div>`;
    });
}

// NAVIGATION
function scrollToSection(section){
    let el = document.getElementById(section);
    if(el) el.scrollIntoView({behavior:"smooth"});
}
</script>
</head>
<body>
<div class="container">

    <!-- DASHBOARD NOTICE -->
    <div class="card" id="dashboard">
        <h3>üìä Dashboard</h3>
        <div class="notice">‡¶è‡¶ü‡¶ø ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶´‡¶ø‡¶∏‡ßá‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶á‡¶ü‡•§ ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶â‡¶∞‡¶æ‡¶ß‡ßÅ‡¶∞‡¶æ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</div>
        <p>User: <b id="nameBox"></b> | ID: <b id="idBox"></b></p>
        <p>Balance: <b id="balanceBox">0.00</b> BDT</p>
    </div>

    <!-- TASKS -->
    <div class="card" id="tasks">
        <h3>üéØ Tasks</h3>
        <button onclick="joinChannel(0)">üì¢ Join Channel 1 (+5‡ß≥)</button>
        <button onclick="joinChannel(1)">üì¢ Join Channel 2 (+5‡ß≥)</button>
        <button onclick="joinChannel(2)">üì¢ Join Channel 3 (+5‡ß≥)</button>
        <button onclick="viewChannel()">üëÄ View Channel (+1‡ß≥ first time)</button>
        <button onclick="watchAd()">‚ñ∂Ô∏è Watch Ad (+10‡ß≥)</button>
        <p style="margin-top:10px">Ads Watched: <b id="adsWatched">0 / 30</b></p>
        <button onclick="loadTaskHistory()">üìú Task History</button>
        <div id="taskHistoryList" class="task-history"></div>
    </div>

    <!-- WITHDRAW -->
    <div class="card" id="withdraw">
        <h3>Withdraw</h3>
        <form id="withdrawForm" onsubmit="event.preventDefault(); sendWithdraw();">
            <input type="number" id="amount" placeholder="Amount">
            <input type="text" id="number" placeholder="Bkash/Nagad Number">
            <select id="method">
                <option>Bkash</option>
                <option>Nagad</option>
                <option>Rocket</option>
            </select>
            <button type="submit">Withdraw</button>
        </form>
        <button onclick="loadHistory()">Load Withdraw History</button>
        <div id="historyList" class="withdraw-history"></div>
    </div>

    <!-- PROFILE -->
    <div class="card" id="profile">
        <h3>üë§ Profile</h3>
        <p>Name: <b id="nameBoxProfile"></b></p>
        <p>Username: <b id="usernameSpan"></b></p>
        <p>User ID: <b id="idBoxProfile"></b></p>
    </div>

</div>

<div class="nav">
    <div onclick="scrollToSection('dashboard')">Home</div>
    <div onclick="scrollToSection('tasks')">Tasks</div>
    <div onclick="scrollToSection('withdraw')">Withdraw</div>
    <div onclick="scrollToSection('profile')">Profile</div>
</div>

<script>
document.getElementById("nameBoxProfile").innerText = USER_NAME;
document.getElementById("usernameSpan").innerText = USER_USERNAME;
document.getElementById("idBoxProfile").innerText = USER_ID;
</script>
</body>
</html>
