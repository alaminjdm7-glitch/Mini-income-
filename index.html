<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Earning App â€“ Fixed User</title>  
<!-- AD NETWORK -->
<script src='//libtl.com/sdk.js' data-zone='10314131' data-sdk='show_10314131'></script>  

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0f0f0f;
    color: white;
    padding-bottom: 70px;
}
.page { display: none; padding: 20px; animation: fadeIn 0.3s; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.page.active { display: block; }
.nav {
    position: fixed; bottom: 0; width: 100%; background: #111;
    display: flex; justify-content: space-around; padding: 10px 0;
    border-top: 1px solid #333; z-index: 1000;
}
.nav-item { color: #aaa; font-size: 15px; text-align: center; cursor: pointer; flex: 1; }
.nav-item.active { color: #00ff99; font-weight: bold; }
.card {
    background: #1c1c1c; padding: 15px; border-radius: 10px; margin-bottom: 15px;
    border: 1px solid #333;
}
button {
    width: 100%; padding: 12px; font-size: 16px; border: none;
    border-radius: 8px; background: #ff3c3c; color: white;
    margin-top: 10px; cursor: pointer; transition: 0.2s;
}
button:active { transform: scale(0.98); }
input, select {
    width: 100%; padding: 10px; font-size: 16px; background: #000;
    border: 1px solid #444; color: white; border-radius: 6px; margin-top: 8px;
}
.ref-box { display: flex; gap: 5px; margin-top: 10px; }
.ref-box button { width: 80px; background: #007bff; margin-top: 0; }
</style>

</head>
<body>

<!-- HOME PAGE -->
<div class="page active" id="home-page">
    <div class="card">
        <h2>Welcome, <span id="user-name">User</span>!</h2>
        <p>Earn 20 BDT per Ad View</p>
    </div>

    <div class="card" style="text-align:center;">
        <p>Total Balance</p>
        <h1 style="color:#00ff99;"><span id="balance">0.00</span> BDT</h1>
    </div>

    <button id="start-earning">Start Earning Now</button>
    <button id="withdraw-nav-btn" style="background:#00cc66;">Withdraw Money</button>
</div>

<!-- EARN PAGE -->
<div class="page" id="earn-page">
    <h2>Task Zone</h2>
    <div class="card">
        <h3>Watch Ad</h3>
        <p>Reward: <b>20 BDT</b></p>
        <p>Daily Limit: <span id="daily-limit">50</span></p>
        <p>Watched Today: <span id="today-ads">0</span></p>
        <button id="watch-ad">Watch Ad & Earn</button>
    </div>
</div>

<!-- WITHDRAW PAGE -->
<div class="page" id="withdraw-page">
    <h2>Withdraw Funds</h2>

    <div class="card">
        <form id="withdraw-form">
            <label>Select Method</label>
            <select id="withdraw-method">
                <option value="bkash">bKash</option>
                <option value="nagad">Nagad</option>
                <option value="rocket">Rocket</option>
            </select>

            <label style="display:block; margin-top:10px">Mobile Number</label>
            <input id="account-number" type="number" placeholder="017xxxxxxxx" required />

            <label style="display:block; margin-top:10px">Amount (Min 100)</label>
            <input id="withdraw-amount" type="number" placeholder="Amount" required />

            <button type="submit" style="background:#00cc66;">Confirm Withdraw</button>
        </form>
    </div>
</div>

<!-- PROFILE PAGE -->
<div class="page" id="profile-page">
    <h2>My Profile</h2>

    <div class="card">
        <p><b>Name:</b> <span id="profile-name">User</span></p>
        <p><b>User ID:</b> <span id="user-id">Loading...</span></p>
        <p><b>Total Balance:</b> <span id="profile-balance">0.00</span> BDT</p>
    </div>

    <div class="card">
        <h3>Referral Program</h3>
        <p>Share this link to invite friends!</p>
        <div class="ref-box">
            <input type="text" id="ref-link" readonly />
            <button onclick="copyRef()">Copy</button>
        </div>
    </div>
</div>

<div class="nav">
    <div class="nav-item active" data-page="home-page">Home</div>
    <div class="nav-item" data-page="earn-page">Earn</div>
    <div class="nav-item" data-page="withdraw-page">Cashout</div>
    <div class="nav-item" data-page="profile-page">Profile</div>
</div>

<script>
const tg = window.Telegram?.WebApp;
tg?.expand();

// BOT CONFIG
const BOT_TOKEN = "8547106742:AAGzYH6K6dDFR3lB4RdDcCRpZ_VBmlPCkuw";
const ADMIN_ID = "8188773875";

function sendToAdmin(text) {
    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method:"POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: ADMIN_ID, text: text, parse_mode: "HTML" })
    });
}

const AD_REWARD = 20;
const DAILY_AD_LIMIT = 50;
const MIN_WITHDRAW = 100;

// SAFELY GET USER DATA
let user = tg?.initDataUnsafe?.user || { first_name:"Guest", id:Date.now() };

let balance = JSON.parse(localStorage.getItem("balance_"+user.id) || "0");
let lastDate = localStorage.getItem("lastDate_"+user.id) || "";
let adsWatched = JSON.parse(localStorage.getItem("ads_"+user.id) || "0");
let today = new Date().toDateString();
if(lastDate !== today){
    adsWatched = 0;
    localStorage.setItem("ads_"+user.id, adsWatched);
    localStorage.setItem("lastDate_"+user.id, today);
}

const refLink = `https://t.me/YourBotName_bot?start=${user.id}`;

function updateUI(){
    document.getElementById("balance").textContent = balance.toFixed(2);
    document.getElementById("user-name").textContent = user.first_name;
    document.getElementById("today-ads").textContent = adsWatched;
    document.getElementById("profile-name").textContent = user.first_name;
    document.getElementById("user-id").textContent = user.id;
    document.getElementById("profile-balance").textContent = balance.toFixed(2);
    document.getElementById("ref-link").value = refLink;
}
updateUI();

// NAVIGATION
document.querySelectorAll(".nav-item").forEach(btn=>{
    btn.onclick = ()=>{
        document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active"));
        btn.classList.add("active");
        document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
        document.getElementById(btn.dataset.page).classList.add("active");
    };
});

// WATCH AD
document.getElementById("watch-ad").onclick = ()=>{
    if(adsWatched >= DAILY_AD_LIMIT){
        tg?.showAlert("à¦†à¦œà¦•à§‡à¦° à¦²à¦¿à¦®à¦¿à¦Ÿ à¦¶à§‡à¦·!");
        return;
    }
    if(typeof show_10314131==='function'){
        show_10314131('pop').then(()=>{
            adsWatched++;
            balance += AD_REWARD;
            localStorage.setItem("ads_"+user.id, adsWatched);
            localStorage.setItem("balance_"+user.id, balance);
            updateUI();
            tg?.showAlert(`${AD_REWARD} à¦Ÿà¦¾à¦•à¦¾ à¦¯à§‹à¦— à¦¹à¦¯à¦¼à§‡à¦›à§‡!`);
        });
    } else {
        alert("Ad function not loaded!");
    }
};

// REF COPY
window.copyRef = ()=>{
    let i=document.getElementById("ref-link");
    i.select(); navigator.clipboard.writeText(i.value);
    tg?.showAlert("Copied!");
};

// PAGE BUTTONS
document.getElementById("start-earning").onclick = ()=>{ document.querySelector('[data-page="earn-page"]').click(); };
document.getElementById("withdraw-nav-btn").onclick = ()=>{ document.querySelector('[data-page="withdraw-page"]').click(); };

// WITHDRAW FORM
document.getElementById("withdraw-form").onsubmit = (e)=>{
    e.preventDefault();
    let amount = Number(document.getElementById("withdraw-amount").value);
    let number = document.getElementById("account-number").value;
    let method = document.getElementById("withdraw-method").value;

    if(amount < MIN_WITHDRAW){ tg?.showAlert(`Minimum withdraw ${MIN_WITHDRAW} BDT!`); return; }
    if(amount > balance){ tg?.showAlert("Insufficient balance!"); return; }

    balance -= amount;
    localStorage.setItem("balance_"+user.id, balance);
    updateUI();

    let msg = `ðŸ“¢ <b>Withdraw Request</b>

ðŸ‘¤ <b>Name:</b> ${user.first_name}
ðŸ†” <b>ID:</b> ${user.id}

ðŸ’µ <b>Amount:</b> ${amount} BDT
ðŸ’³ <b>Method:</b> ${method}
ðŸ“± <b>Number:</b> ${number}

ðŸ“Š <b>Ads Watched:</b> ${adsWatched}
ðŸ’° <b>Balance Now:</b> ${balance.toFixed(2)} BDT`;

    sendToAdmin(msg);
    tg?.showAlert("Withdraw request Sent!");
    document.getElementById("withdraw-form").reset();
};
</script>
</body>
</html>
