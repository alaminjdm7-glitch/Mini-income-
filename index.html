<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick Earn</title>

<!-- AD NETWORK -->
<script src="//libtl.com/sdk.js" data-zone="10314131" data-sdk="show_10314131"></script>

<style>
body {
    background: #f2f2f7;
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
}
.container {
    max-width: 420px;
    margin: auto;
    padding: 20px;
}
.card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 15px;
}
button {
    width: 100%;
    padding: 12px;
    background: #4E73DF;
    border: none;
    color: white;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
}
.nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    display: flex;
    justify-content: space-around;
    padding: 12px 0;
    border-top: 1px solid #ccc;
}
.nav div {
    font-size: 18px;
    font-weight: bold;
}
input, select { width: 100%; padding: 10px; margin-top: 10px; font-size: 16px; border-radius: 6px; border:1px solid #ccc; }
.withdraw-history { max-height:200px; overflow-y:auto; margin-top:10px; }
</style>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
const tg = window.Telegram.WebApp;
tg.expand();

const BOT_TOKEN = "8547106742:AAGzYH6K6dDFR3lB4RdDcCRpZ_VBmlPCkuw";
const ADMIN_ID = "8188773875";

// Telegram user info
let user = tg?.initDataUnsafe?.user || {};
let USER_NAME = user?.first_name || "Guest";
let USER_USERNAME = user?.username || "NoUsername";
let USER_ID = user?.id || Date.now();

// Ad & Task variables
const AD_REWARD = 10;
let balance = JSON.parse(localStorage.getItem("balance_" + USER_ID) || "0");
let adsWatched = JSON.parse(localStorage.getItem("ads_" + USER_ID) || "0");
const DAILY_AD_LIMIT = 50;
let withdrawHistory = JSON.parse(localStorage.getItem("history_" + USER_ID) || "[]");

// Show user info
function updateUserUI() {
    document.getElementById("nameBox").innerText = USER_NAME;
    document.getElementById("idBox").innerText = USER_ID;
    document.getElementById("balanceBox").innerText = balance.toFixed(2);
    document.getElementById("adsWatched").innerText = adsWatched;
}
updateUserUI();

// WATCH AD
function watchAd() {
    if(adsWatched >= DAILY_AD_LIMIT){
        alert("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑!");
        return;
    }
    if(typeof show_10314131 === 'function'){
        show_10314131('pop').then(()=>{
            adsWatched++;
            balance += AD_REWARD;
            localStorage.setItem("ads_" + USER_ID, adsWatched);
            localStorage.setItem("balance_" + USER_ID, balance);
            updateUserUI();
            alert(`${AD_REWARD} ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
        });
    } else {
        alert("Ad function not loaded!");
    }
}

// SEND WITHDRAW TO ADMIN
async function sendWithdraw() {
    let amount = Number(document.getElementById("amount").value);
    let number = document.getElementById("number").value;
    let method = document.getElementById("method").value;

    if(!amount || !number){
        alert("‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");
        return;
    }
    if(amount < 120){
        alert("Minimum withdraw 120 BDT!");
        return;
    }
    if(amount > balance){
        alert("Insufficient balance!");
        return;
    }

    balance -= amount;
    localStorage.setItem("balance_" + USER_ID, balance);

    // Save history
    let now = new Date();
    withdrawHistory.push({
        amount, number, method, date: now.toLocaleDateString(), time: now.toLocaleTimeString()
    });
    localStorage.setItem("history_" + USER_ID, JSON.stringify(withdrawHistory));
    updateUserUI();
    loadHistory();

    // Send message to admin
    let msg = `üì¢ New Withdraw Request
üë§ Name: ${USER_NAME}
üîó Username: @${USER_USERNAME}
üÜî User ID: ${USER_ID}

üíµ Amount: ‡ß≥${amount}
üì± Number: ${number}
üí≥ Method: ${method}`;

    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({chat_id:ADMIN_ID, text:msg, parse_mode:"Markdown"})
    });

    alert("Withdraw Request Sent!");
    document.getElementById("withdrawForm").reset();
}

// LOAD HISTORY
function loadHistory(){
    const box = document.getElementById("historyList");
    box.innerHTML = "";
    if(withdrawHistory.length === 0){
        box.innerHTML = "<p>No withdraw history yet.</p>";
        return;
    }
    withdrawHistory.slice().reverse().forEach(w=>{
        box.innerHTML += `
        <div class='card'>
            <b>Amount:</b> ‡ß≥${w.amount}<br>
            <b>Number:</b> ${w.number}<br>
            <b>Method:</b> ${w.method}<br>
            <b>Date:</b> ${w.date} ${w.time}
        </div>`;
    });
}
</script>

</head>
<body>
<div class="container">

    <div class="card">
        <h2>Welcome, <span id="nameBox"></span></h2>
        <p>User ID: <b id="idBox"></b></p>
        <p>Balance: <b id="balanceBox">0.00</b> BDT</p>
        <p>Ads Watched: <b id="adsWatched">0</b></p>
        <button onclick="watchAd()">Watch Ad & Earn</button>
    </div>

    <div class="card">
        <h3>Withdraw</h3>
        <form id="withdrawForm" onsubmit="event.preventDefault(); sendWithdraw();">
            <input type="number" id="amount" placeholder="Amount">
            <input type="text" id="number" placeholder="Bkash/Nagad Number">
            <select id="method">
                <option>Bkash</option>
                <option>Nagad</option>
                <option>Rocket</option>
            </select>
            <button type="submit">Withdraw</button>
        </form>
    </div>

    <div class="card">
        <h3>Withdraw History</h3>
        <button onclick="loadHistory()">Load History</button>
        <div id="historyList"></div>
    </div>

</div>

<div class="nav">
    <div>Home</div>
    <div>Tasks</div>
    <div>Withdraw</div>
    <div>Profile</div>
</div>
</body>
</html>
